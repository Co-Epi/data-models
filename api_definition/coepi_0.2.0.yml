openapi: 3.0.2
info:
  description: This is the API model for CoEpi Server
  version: 0.2.0
  title: CoEpi Server
  license:
    name: MIT License
    url: https://github.com/Co-Epi/data-models/blob/master/LICENSE
    
servers:
  - url: https://coepi.wolk.com:8080
    description: URL Endpoint used for dev/test
    
paths:
  /cenreport:
    post:
      summary: Submit symptom or infection report
      description: Users submit symptom / infection reports and reveal the secret CENKey in their application
      
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reportId: # Suggestion: Why is this being passed by the client? Better to be auto-generated by server?
                  type: string
                  description: Unique Identifier of the infection report
                report:
                  type: string
                  description: Content of the infection report. Example, symptoms
                cenKeys:
                  type: array
                  items:
                    $ref: '#/components/schemas/CenKey'
                  minItems: 1
                  maxItems: 10 # TODO: Discuss appropriate value
                  uniqueItems: true 
              required:
                - reportId
                - report
                - cenKeys
                
      responses:
        '200':
          description: The report was submitted successfully
        '400':
          description: Request Parameter Invalid # TBD
        '500':
          description: Internal Server Error
        default:
          description: Unexpected Error
  
  
  /cenreport/{cenkey}: # Suggestion: Should we allow passing a list of CEN keys to reduce roundtrips ?
    get:
      summary: Returns a list of reports associated with a CEN Key
      parameters:
      - in: path
        name: cenkey
        description: CEN Key for which we need to query the reports
        required: true
        schema:
          $ref: '#/components/schemas/CenKey'
      
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Report'
        '400':
          description: Request Parameter Invalid # TBD
        '401':
          description: CEN Key not found
        '500':
          description: Internal Server Error
        default:
          description: Unexpected Error
      
          
  /cenkeys/{timestamp}:
    get:
      summary: Returns all cenKeys generated between the range [timestamp - 3600, timestamp) # TBD
      parameters:
      - in: path
        name: timestamp
        description: Timestamp in unix epoch format
        required: true
        schema:
          $ref: '#/components/schemas/Timestamp'
          
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CenKey'
        '400':
          description: Request Parameter Invalid # TBD
        '500':
          description: Internal Server Error
        default:
          description: Unexpected Error
                
        
# https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.3.md#referenceObject          
components:
  schemas:
    CenKey:
      description: Contact Event Number (CEN) published by the mobile device
      type: string
      minLength: 5 #TODO: Discuss appropriate value
      maxLength: 100 #TODO: Discuss appropriate value and also a possibly an expected pattern
    
    Report:
      description: Infection report representing symptoms and/or positive infection incident
      type: object
      properties:
        reportId:
          type: string
          description: Unique Identifier of the infection report
          minLength: 1 #TODO: Discuss appropriate value
          maxLength: 100 #TODO: Discuss appropriate value and also a possibly an expected pattern (guid ?)
        report:
          type: string
          description: Content of the infection report consisting of symptoms and/or positive infection incident
          minLength: 1
          maxLength: 10000
        timestamp:
          $ref: '#/components/schemas/Timestamp'
      
    Timestamp:
      type: integer
      description: Timestamp in unix epoch format. It is the number of seconds that have elapsed since the Unix epoch, that is the time 00:00:00 UTC on 1 January 1970, minus leap seconds.
      minimum: 0
  